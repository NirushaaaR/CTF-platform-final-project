{% extends 'base.html' %}
{% block content %}
<div class="container">
    <h1>{{game}}</h1>
    <p>Time remain <span id="days"></span> <span id="hours"></span> <span id="minutes"></span> <span
            id="seconds"></span> </p>
    {% for challenge in game.challenges.all %}
    <p>{{challenge}}</p>
    <form action=""></form>
    {% endfor %}
</div>
{% endblock %}

{% block javascript %}
{{ game.id|json_script:"game-id" }}
<script>
    const gameID = JSON.parse(document.getElementById('game-id').textContent);


    const gameSocket = new WebSocket(
        `ws://${window.location.host}/ws/game/${gameID}/`
    );

    gameSocket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        console.log("onmessage", data)
    }

    gameSocket.onclose = function (e) {
        console.error("Game Socket Close unexpected");
    }

    function makeTimer() {
        let endTime = new Date('{{game.end|date:"U"}}' * 1000);
        endTime = (Date.parse(endTime) / 1000);

        const now = (Date.parse(new Date()) / 1000);

        let timeLeft = endTime - now;

        let days = Math.floor(timeLeft / 86400);
        let hours = Math.floor((timeLeft - (days * 86400)) / 3600);
        let minutes = Math.floor((timeLeft - (days * 86400) - (hours * 3600)) / 60);
        let seconds = Math.floor((timeLeft - (days * 86400) - (hours * 3600) - (minutes * 60)));

        if (hours < "10") { hours = "0" + hours; }
        if (minutes < "10") { minutes = "0" + minutes; }
        if (seconds < "10") { seconds = "0" + seconds; }

        $("#days").html(days + " Days");
        $("#hours").html(hours + " Hours");
        $("#minutes").html(minutes + " Minutes");
        $("#seconds").html(seconds + " Seconds");

    }
    makeTimer();
    setInterval(makeTimer, 1000);
</script>
{% endblock %}