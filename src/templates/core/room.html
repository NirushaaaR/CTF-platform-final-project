{% extends 'base.html' %} {% load custom_filters %} {% load humanize %} {% block content %}
<div class="container">
  <h2 class="mt-4">{{room.title}}</h2>
  <p>Require room:
  {% for require_room in room.prerequisites.all  %}
  <a href="{{require_room.get_absolute_url}}">&lt;{{require_room}}&gt;</a>
  {% endfor %}
  </p>
  <hr>
  {{room.description|safe}}
  {% if not is_participated %}
  <form action="{% url 'room' room.id %}" method="post">
    {% csrf_token %}
    <button type="submit" class="btn btn-lg btn-secondary">Participate</button>
  </form>
  {% else %}

  {% if is_finish %}
  <div class="card mb-3 border-warning box-shadow">
    <h3 class="card-header border-warning">Conclusion</h3>
    <div class="card-body">
      {{room.conclusion|safe}}
    </div>
  </div>
  {% endif %}
  <hr>
  {% for task in tasks %}
  <div class="card my-3 {% if task.task_number in user_answered_tasks %}border-success{% endif %}">
    <div
      class="card-header d-flex justify-content-between {% if task.task_number in user_answered_tasks %}border-success{% endif %} box-shadow">
      <h3>{{task.task_number}} - {{task.title}}</h3>
      <div class="align-self-end pb-1">{{task.points}} points</div>
    </div>
    <div class="card-body">
      <div class="card-text">
        {{task.description|safe}}
      </div>
      <hr>
      <form action="{% url 'enter_flag' room.id %}" method="post">
        <div class="form-row align-items-center">
          <div class="col-md-11">
            {% csrf_token %}
            <input type="hidden" name="task_id" value="{{task.id}}" />
            <input class="form-control" type="text" name="flag" placeholder="{{task.flag|censor_flag}}" />
          </div>
          <div class="col-md-1 text-center">
            <button type="submit" class="btn btn-success">Submit</button>
          </div>
        </div>
      </form>
      <div class="d-inline-flex mt-2">
        {% for hint in hints|get_dict_value:task.task_number %}
        <button type="button" class="btn mr-2" data-toggle="modal" data-target="#task{{task.id}}-hint{{hint.id}}">
          Hint {{forloop.counter}}
        </button>
        <div class="modal fade" id="task{{task.id}}-hint{{hint.id}}" tabindex="-1" role="dialog"
          aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Hint {{forloop.counter}}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                {{hint.hint}}
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% if task.task_number in user_answered_tasks %}
    <div class="card-footer border-success text-success text-right">
      <i class="fas fa-check"></i> cleared {{user_answered_tasks|get_dict_value:task.task_number|naturaltime}}
    </div>
    {% endif %}
  </div>
  {% endfor %}
  {% endif %}
</div>
{% endblock content %}